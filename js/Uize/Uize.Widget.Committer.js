/*
	UIZE JAVASCRIPT FRAMEWORK 2011-04-01

	http://www.uize.com/reference/Uize.Widget.Committer.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Committer',required:'Uize.Widget.Button',builder:function(c_a){var c_b=null,c_c=true,c_d=false;var c_e=c_a.subclass(function(){var c_f=this;c_f.c_g;c_f.c_h=c_f.c_i('commit',function(){c_f.commit()});c_f.c_j=c_f.c_i('clearAll',function(){c_f.clearAll()});c_f.c_k=c_f.c_i('restoreInitial',function(){c_f.restoreInitial()});c_f.c_l=c_f.c_i('restorePrevious',function(){c_f.restorePrevious()});}),c_m=c_e.prototype;c_m.c_i=Uize.Widget.Button.addChildButton;c_m.c_n=function(){if(this.c_g)clearTimeout(this.c_g);};c_m.c_o=function(c_p){var c_f=this,c_q=c_f.c_q,c_r=c_f.c_r,c_s=c_f.get(c_p+'Values'),c_t;for(var c_u in c_r){var c_v=c_q[c_u],c_w={};c_v.instance.set(c_v.name,c_s&&c_s[c_u]!=c_t?c_s[c_u]:'');}};c_m.c_x=function(){var c_f=this,c_y=c_c,c_z=c_c,c_A=c_d,c_B=c_d,c_r=c_f.c_r,c_C=c_f.c_C,c_D=c_f.c_D,c_q=c_f.c_q;for(var c_u in c_r){var c_E=c_C[c_u];if(!c_A)c_A=c_E!==c_r[c_u];if(!c_B)c_B=c_E!==c_D[c_u];if(c_z)c_z=c_E=='';if(c_y)c_y=c_q[c_u].instance.get('isValid')===c_c;}c_f.set({c_z:c_z,
c_y:c_y,c_A:c_A,c_B:c_B,c_F:c_A&&c_y});};c_m.c_G=function(c_u,c_v){var c_f=this,c_H=c_v.instance,c_I=c_v.name;c_H.wire('Changed.'+c_I,function(){c_f.c_C[c_u]=c_H.get(c_I);c_f.fire('Changed.uncommittedValues');c_f.c_x();if(c_f.c_F&&c_f.c_J){c_f.c_n();c_f.c_g=setTimeout(function(){c_f.commit()},c_f.c_J)}});c_H.wire('Changed.isValid',function(){c_f.c_x()});};c_m.clearAll=function(){this.c_o('clear')};c_m.commit=function(){var c_f=this;c_f.c_n();if(c_f.c_F){c_f.set({c_r:Uize.copyInto({},c_f.c_C)});c_f.fire('Commit');c_f.c_x();}};c_m.addWatchedProperties=function(c_K){var c_L= -1,c_M=c_K?c_K.length:0,c_f=this,c_r={},c_C={},c_D={},c_N={};for(;++c_L<c_M;){var c_O=c_K[c_L];if(c_O){var c_P=c_O.alias,c_Q=c_O.name,c_R=c_O.instance,c_v={instance:c_R,name:c_Q};c_N[c_P]=c_v;c_f.c_G(c_P,c_v);c_r[c_P]=c_C[c_P]=c_D[c_P]=c_R.get(c_Q);}}Uize.copyInto(c_f.c_q||(c_f.c_q={}),c_N);c_f.set({c_r:Uize.copyInto(c_f.c_r,c_r),c_C:Uize.copyInto(c_f.c_C,c_C),c_D:Uize.copyInto(c_f.c_D,c_D)});c_f.c_x();c_f.fire({
name:'Watched Properties Added',properties:c_N});};c_m.removeWatchedProperties=function(c_S){var c_L= -1,c_T={},c_U=c_S?c_S.length:0,c_f=this,c_r=c_f.c_r,c_D=c_f.c_D,c_C=c_f.c_C,c_q=c_f.c_q;for(;++c_L<c_U;){var c_u=c_S[c_L],c_v=c_q[c_u];if(c_v){var c_H=c_v.instance;c_H.unwire('Changed.isValid');c_H.unwire('Changed.'+c_v.name);delete c_q[c_u];delete c_r[c_u];delete c_C[c_u];delete c_D[c_u];c_T[c_u]=c_v;}}c_f.c_x();c_f.fire({name:'Watched Properties Removed',properties:c_T});};c_m.restoreInitial=function(){this.c_o('initial')};c_m.restorePrevious=function(){this.c_o('committed')};c_e.registerProperties({c_z:{name:'allClear',onChange:function(){this.c_j.set({enabled:this.c_z?c_d:'inherit'});},value:c_d},c_y:{name:'allValid',value:c_d},c_B:{name:'anyNotInitial',onChange:function(){this.c_k.set({enabled:this.c_B?'inherit':c_d});},value:c_d},c_A:{name:'anyNotCommitted',onChange:function(){this.c_l.set({enabled:this.c_A?'inherit':c_d});},value:c_d},c_J:'autoCommitDelay',c_r:{name:'committedValues',value:{}},c_D:{
name:'initialValues',value:{}},c_F:{name:'readyToCommit',onChange:function(){this.c_h.set({enabled:this.c_F?'inherit':c_d});},value:c_d},c_C:{name:'uncommittedValues',value:{}},c_q:{name:'watchedProperties',onChange:function(){var c_f=this,c_q=c_f.c_q,c_r={},c_C={},c_D={};if(c_q)for(var c_u in c_q){var c_v=c_q[c_u];c_r[c_u]=c_C[c_u]=c_D[c_u]=c_v.instance.get(c_v.name);c_f.c_G(c_u,c_v);}c_f.set({c_r:c_r,c_D:c_D,c_C:c_C});c_f.c_x();}}});return c_e;}});