/*
	UIZE JAVASCRIPT FRAMEWORK 2011-04-01

	http://www.uize.com/reference/Uize.Widget.Droplist.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Droplist',superclass:'Uize.Widget.Picker.SelectorOld',required:['Uize.Widget.PopupPalette','Uize.Node.Event','Uize.Widget.FormElement','Uize.Node'],builder:function(f_a){var f_b=null,f_c=true,f_d=false;var f_e=f_a.subclass(f_b,function(){var f_f=this,f_g=f_f.addChild('palette',Uize.Widget.PopupPalette,{positioning:function(){return f_f.getNode('buttonShell')}}),f_h=f_f.children.options;f_g.fade.set({duration:0});f_f.wire({'Changed.isDirty':function(){f_f.f_i()},'Changed.value':function(){f_f.f_i()},'Changed.values':function(){var f_j=f_f.get('values');if(f_f.isWired){f_f.f_i();f_f.f_k();f_f.f_l();var f_m=f_f.getNode('input');if(f_m&&f_f.get('type')=='select-one'){for(var f_n= -1,f_o=f_j.length,f_h=f_m.options,f_p=f_h.length,f_q=f_f.get('valueMap');++f_n<f_o;){var f_r=f_j[f_n],f_s;if(f_n<f_p){f_s=f_h[f_n];}else{f_s=document.createElement('option');try{f_m.add(f_s,f_b)}catch(f_t){f_m.add(f_s)}}f_f.setNodeProperties(f_s,{value:f_r.name,text:f_r[f_q.displayName],
selected:f_f.get('valueNo')==f_n});}for(var f_u=f_p-1;f_u>=f_n;f_u--)f_m.remove(f_u);}}},'Changed.valueNo':function(){var f_m=f_f.getNode('input');if(f_m)f_m.selectedIndex=f_f.get('valueNo');}});}),f_v=f_e.prototype;f_v.f_i=function(){var f_f=this,f_r=f_f.getValueObject(),f_q=f_f.get('valueMap');if(f_f.isWired){var f_w=f_r&&(f_f.get('isDirty')|| !f_f.f_x),f_y=f_w?f_r[f_q.displayName]:f_f.f_x;f_f.setNodeValue('displayName',f_y);f_f.setNodeProperties(['displayName',f_f.children.palette.children.selector.getNode()],{title:f_y});if(f_q.thumbnail){f_f.setNodeProperties('thumbnail',{src:f_w?f_r[f_q.thumbnail]:'',alt:f_y});f_f.setNodeStyle('thumbnail',{display:f_w?'inline':'none'});}}};f_v.f_l=function(){var f_f=this;if(f_f.isWired){var f_z=f_f.getNode('buttonShell'),f_A=f_f.children.palette.getNode('palette');f_z&&f_A&&f_f.setNodeStyle(f_A,{minWidth:Uize.Node.getDimensions(f_z).width});}};f_v.f_k=function(){var f_f=this;if(f_f.isWired&&f_f.f_B){var f_C=f_f.getNode(),f_D=f_C?f_C.style.display:f_b,
f_q=f_f.get('valueMap'),f_E=f_f.getNode('displayName'),f_F=f_f.getNodeValue(f_E),f_x=f_f.f_x,f_j=f_f.get('values'),f_o=f_j.length,f_n= -1,f_G=0,f_H;f_C&&f_f.displayNode(f_C);f_f.setNodeStyle(f_E,{width:'auto'});function f_I(f_y){f_f.setNodeValue(f_E,f_y);f_H=Uize.Node.getDimensions(f_E).width;f_G=f_H>f_G?f_H:f_G;}for(;++f_n<f_o;)f_I(f_j[f_n][f_q.displayName]);f_f.f_x&&f_I(f_f.f_x);f_f.setNodeStyle(f_E,{width:f_G});f_f.setNodeValue(f_E,f_F);if(f_C)f_C.style.display=f_D;}};f_v.updateUi=function(){var f_f=this;if(f_f.isWired){f_f.f_i();f_f.f_k();f_f.f_l();f_a.prototype.updateUi.call(f_f);}};f_v.wireUi=function(){var f_f=this;if(!f_f.isWired){var f_J=f_f.children.options.getNode();f_f.children.palette.children.selector.displayNode('',f_J);f_a.prototype.wireUi.call(f_f);f_f.setNodeStyle('input',{display:f_f.get('type')!='select-one'|| !f_J?'inline':'none'});}};f_e.registerProperties({f_x:{name:'nonDirtyLabel',onChange:f_v.f_i,value:''},f_B:{name:'seen',onChange:f_v.f_k,value:f_c}});f_e.set({valueMap:{
displayName:'displayName'},valueConformerPreset:{type:'inValues'}});return f_e;}});