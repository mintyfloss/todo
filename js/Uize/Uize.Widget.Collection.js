/*
	UIZE JAVASCRIPT FRAMEWORK 2011-04-01

	http://www.uize.com/reference/Uize.Widget.Collection.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Collection',required:['Uize.Widget.Button','Uize.Node.Event'],builder:function(c_a){var c_b=true,c_c=false,c_d=null,c_e;var c_f=c_a.subclass(function(){var c_g=this;c_g.c_h=0;c_g.c_i=c_g.itemWidgets=[];c_g.wire('Items Changed',function(){c_g.set({c_j:c_g.c_i.length});c_g.c_k();});},function(){var c_g=this;c_g.c_l('selectAll',function(){c_g.selectAll()},{affectedBy:['allSelected','totalItems','selectionMode','isEmpty'],stateEvaluator:function(){return(!this.c_m&& !this.c_n&&(this.c_o!='single'||this.c_j==1))}});c_g.c_l('selectNone',function(){c_g.selectAll(c_c)},'someSelected');c_g.c_l('remove',function(){c_g.c_p(c_g.c_q(),c_b)},'someSelected');}),c_r=c_f.prototype;c_r.c_l=c_r.addControlButton=function(c_s,c_t,c_u){var c_g=this,c_v=Uize.Widget.Button.addChildButton.call(c_g,c_s,c_t);if(typeof c_u=='string'&&(c_u=c_u.replace(' ',''))){var c_w=c_u.replace('!',''),c_x=c_u.charAt(0)=='!';c_u={affectedBy:c_w,stateEvaluator:function(){return c_g.get(c_w)!=c_x}};}if(c_u){
var c_y=c_u.affectedBy;if(typeof c_y=='string')c_y=[c_y];function c_z(){c_v.set({enabled:c_u.stateEvaluator.call(c_g)?'inherit':c_c});}for(var c_A= -1,c_B=c_y.length;++c_A<c_B;)c_g.wire('Changed.'+c_y[c_A],c_z);c_z();};return c_v;};c_r.c_C=function(){this.fire('Items Changed')};c_r.c_k=function(){this.set({c_D:this.c_q().length});};c_r.c_E=function(){this.isWired&&this.setNodeValue('totalItems',this.c_j);};c_r.c_F=function(){var c_g=this;c_g.c_G(function(c_H){c_g.c_I(c_H)});c_g.c_i.length=0;};c_r.c_I=function(c_H){c_H.removeUi();c_H.kill();this.removeChild(c_H);};c_r.c_p=function(c_J,c_K){var c_g=this,c_L=c_J.length;if(c_L){function c_M(){c_g.remove(c_J,c_K)}if(c_K){c_g.confirm({message:c_g.localize(c_L==1?'removeItemConfirmation':'removeItemsConfirmation',{0:c_L,itemsToRemove:c_J}),title:c_g.localize(c_L==1?'removeItemConfirmationTitle':'removeItemsConfirmationTitle',{0:c_L,itemsToRemove:c_J}),yesHandler:c_M});}else{c_M();}}};c_r.addItemWidget=function(c_N,c_O){var c_g=this,c_H=c_g.addChild(c_N,c_g.c_P,
Uize.copyInto(c_O,c_g.getItemWidgetProperties()));c_H.wire({'Changed.selected':function(){if(c_H.get('selected')){c_g.c_o=='single'&&c_g.selectAll(c_c,c_g.c_Q=c_H);c_g.fire({name:'Item Selected',itemWidget:c_H});}else if(c_H==c_g.c_Q)c_g.c_Q=c_d;c_g.c_k();},'Click Selected':function(c_R){var c_S=c_R.domEvent,c_T=c_S&&c_S.shiftKey,c_U=(!c_T&&c_R.forceToggle)||(c_S&&c_S.ctrlKey),c_V=c_U||c_T;c_V&&Uize.Node.Event.abort(c_S);if((c_g.c_o=='single'&& !(c_U&&c_H.get('selected')))|| !c_V){c_H.set({selected:c_b});c_g.selectAll(c_c,c_g.c_Q=c_H);}else{c_T?c_g.selectRange(c_g.c_Q,c_H):(c_g.c_Q=c_H).toggle('selected');}},Remove:function(c_R){c_g.c_p(c_H.get('selected')&&c_g.c_W?c_g.c_q():[c_H],c_R.byUser);}});c_g.c_i.push(c_H);c_g.isWired&&c_H.insertOrWireUi();return c_H;};c_r.forAll=c_r.c_G=function(c_X){for(var c_Y= -1,c_i=this.c_i,c_Z=c_i.length;++c_Y<c_Z;){if(c_X(c_i[c_Y],c_Y)===c_c)break;}};c_r.getItemWidgetProperties=function(){return this.c_0};c_r.makeItemWidgetName=function(c_1){var c_g=this;return(
(c_1&&c_g.c_2&&c_1[c_g.c_2])||(c_g.c_3+(c_g.c_i.length? ++c_g.c_h:c_g.c_h=0)));};c_r.getSelected=c_r.c_q=function(c_4){var c_5=[];this.c_G(function(c_H){c_H.get('selected')&&c_5.push(c_H)});return!c_5.length&&c_4?this.c_i.concat():c_5;};c_r.getPropertyForItems=function(c_w,c_i){var c_6=[];for(var c_Y= -1,c_Z=c_i.length,c_7=c_w==c_e;++c_Y<c_Z;){var c_8=c_i[c_Y].get('properties');c_6.push(c_7?c_8:c_8[c_w]);}return c_6;};c_r.getPropertyForSelected=function(c_w,c_4){return this.getPropertyForItems(c_w,this.c_q(c_4));};c_r.updateUi=function(){this.c_E()};c_r.remove=function(c_J,c_K){var c_g=this;function c_9(c_J,c_K){c_g.finishRemove(c_J,c_K);}c_g.fire({name:'Remove',itemWidgets:c_J,byUser:c_K,finishRemove:c_9}).handled||c_9(c_J,c_K);};c_r.finishRemove=function(c_J,c_K){var c_g=this,c_ba=c_g.get('items'),c_i=c_g.itemWidgets,c_Z=c_i.length,c_bb=c_J,c_bc=c_J.length;if(c_bc==c_Z){c_g.c_F();}else{c_bb=[];c_bc=0;var c_bd=c_d;c_g.forAll(function(c_H,c_Y){if(Uize.isIn(c_J,c_H)){c_bd=c_d;c_bb.push(c_H);c_bc++;
c_g.c_I(c_H,c_Y);}else{if(!c_bd&& !c_H.get('locked'))c_bd=c_H;if(c_bc){c_ba[c_Y-c_bc]=c_ba[c_Y];c_i[c_Y-c_bc]=c_H;}}});c_ba.length=c_i.length=c_Z-c_bc;}if(c_bc){c_g.fire({name:'Items Removed',byUser:c_K,totalBeforeRemove:c_Z,itemWidgetsRemoved:c_bb,totalRemoved:c_bc,percentRemoved:c_bc/c_Z*100});c_g.c_C();}};c_r.selectAll=function(c_5,c_be){if(!(c_5=c_5!==c_c)||this.c_o!='single'||this.c_j==1)this.c_G(function(c_H){c_H!==c_be&&c_H.set({selected:c_5});});};c_r.selectRange=function(c_bf,c_bg){var c_g=this;if(c_bf&&c_bg&&(c_g.c_o=='multi'||c_bf==c_bg)){var c_bh=c_c;c_g.c_G(function(c_H){var c_bi=c_H==c_bf||c_H==c_bg;if(c_bi)c_bh= !c_bh;c_H.set({selected:c_bh||c_bi});});}};c_r.selectNone=function(){this.selectAll(c_c)};c_f.registerProperties({c_m:{name:'allSelected',value:c_c},c_n:{name:'isEmpty',value:c_b},c_2:{name:'itemPropertyForItemWidgetName',value:'id'},c_W:{name:'itemRemoveActsOnSelection',value:c_c},c_ba:{name:'items',value:[],onChange:function(){var c_g=this;c_g.c_F();for(
var c_bj= -1,c_ba=c_g.c_ba,c_bk=c_ba.length;++c_bj<c_bk;){var c_1=c_ba[c_bj];c_g.addItemWidget(c_g.makeItemWidgetName(c_1),{properties:c_1});}c_g.c_C();}},c_P:'itemWidgetClass',c_3:{name:'itemWidgetNamePrefix',value:'item'},c_0:'itemWidgetProperties',c_bl:{name:'oneSelected',value:c_c},c_o:{name:'selectionMode',value:'multi'},c_bm:{name:'someSelected',value:c_c},c_j:{name:'totalItems',onChange:function(){this.set({c_n:!this.c_j});this.c_E();}},c_D:{name:'totalSelected',value:0,onChange:function(){var c_g=this,c_D=c_g.c_D;c_g.set({c_bl:c_D==1,c_bm:c_D>0,c_m:c_D>0&&c_D==c_g.c_j});}}});return c_f;}});