/*
	UIZE JAVASCRIPT FRAMEWORK 2011-04-01

	http://www.uize.com/reference/Uize.Widget.FormElement.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.FormElement',required:['Uize.Node','Uize.Node.Event','Uize.Widget.Collapsy','Uize.Node.Classes'],builder:function(c_a){var c_b=true,c_c=false,c_d=null,c_e,c_f='never',c_g='tentativeValueChanged',c_h='valueChanged',c_i='validated',c_j='finished',c_k='validatedAfterFirstFinish';var c_l=c_a.subclass(c_d,function(){var c_m=this,c_n=c_m.addChild('warning',Uize.Widget.Collapsy,c_m.c_o);function c_p(){c_m.c_p()}c_m.wire({'Changed.busyInherited':c_p,'Changed.enabledInherited':c_p,Blur:function(){c_n.set({collapsed:c_b})},Focus:function(){c_n.set({collapsed:c_c})}});c_m.c_n=c_n;c_m.c_q=c_b;}),c_r=c_l.prototype;c_r.c_s=function(){return this.getNode('input')};c_r.c_t=function(){var c_u=this.parent,c_v;if(c_u&&c_u.parent){c_v=c_u.parent;if(!c_v.isForm)c_v=c_d;}return c_v;};c_r.c_p=function(){var c_m=this;if(c_m.isWired){var c_w=c_m.get('enabledInherited')&& !c_m.get('busyInherited');c_m.setNodeProperties(c_m.c_s(),{readOnly:!c_w,disabled:!c_w});}};c_r.c_x=function(){var c_m=this;
if(c_m.isWired){var c_y=c_m.c_s(),c_z=c_m.c_z;c_z+''!=c_m.getNodeValue(c_y)&&c_m.setNodeValue(c_y,c_z);}};c_r.c_A=function(){var c_m=this,c_B=c_m.c_B,c_C=c_m.c_C;if(c_m.isWired){c_m.c_n&&c_m.c_n.set(Uize.copyInto({shown:c_B},c_C?{expandedMessage:c_C}:c_d));Uize.Node.Classes.setState([c_m.c_s(),c_m.getNode('label')],c_m.c_D,c_B);}};c_r.checkWarningShown=c_r.c_E=function(){var c_m=this,c_F=c_m.c_F,c_v=c_m.c_t(),c_G=c_m.c_B;c_m.set({c_B:c_m.c_H&&c_m.c_I==c_c&&(c_v?c_v.get('warningShown'):(c_m.c_J&&(c_F==c_i||(c_F==c_j&&(c_m.c_K||c_G))||(c_F==c_k&&(c_m.c_L||c_G)))))});};c_r.getMoreValidators=c_e;c_r.checkIsEmpty=function(){return this.c_z==c_d||this.c_z==''};c_r.restore=function(){this.set({c_L:c_c,c_M:'inherit',c_z:this.c_N})};c_r.updateUi=function(){var c_m=this;if(c_m.isWired){c_m.c_p();c_m.c_x();c_m.c_A();c_a.prototype.updateUi.call(c_m);}};c_r.validate=c_r.c_O=function(){var c_m=this;if(c_m.c_q){var c_P=c_m.c_P,c_Q=(Uize.isArray(c_P)?c_P:(c_P!=c_d?[c_P]:c_d)),
c_R=c_m.getMoreValidators?c_m.getMoreValidators():c_d;if(c_R)c_Q=c_Q?c_Q.concat(c_R):c_R;function c_S(c_I){c_m.set({c_I:c_I})}if(c_Q!=c_d){var c_z=c_m.c_T==c_g?c_m.c_U:c_m.c_z,c_V=c_Q.length,c_W= -1;function c_X(){if(++c_W<c_V){function c_Y(c_I,c_Z){if(c_I==c_c){c_m.set({c_C:c_Z||c_m.c_0});c_S(c_c);}else c_X();}var c_1=c_Q[c_W],c_I=c_1 instanceof RegExp?c_1.test(c_z):(c_1.func||Uize.isFunction(c_1)?(c_1.func||c_1).call(c_m,c_z,c_Y):c_z==c_1);c_Y(c_I,c_1.msg);}else c_S(c_b);}c_X();}else c_S(c_b)}};c_r.wireUi=function(){var c_m=this;if(!c_m.isWired){var c_y=c_m.c_s();if(c_y){c_m.c_2=c_y.type;c_m.c_3=c_y.name;function c_4(c_5,c_6){c_m.fire({name:c_5,domEvent:c_6})}function c_7(c_8){c_4('Click',c_8)}function c_9(c_8){c_4('Key Up',c_8)}function c_ba(c_bb){c_m.set({c_z:c_m.getNodeValue(c_y)});!c_bb&&c_m.c_M!=c_b&&c_m.set({c_M:c_b});}var c_bc={blur:function(c_8){c_ba();c_m.set({c_bd:c_c});},focus:function(c_8){c_m.set({c_bd:c_b})},click:function(c_8){c_ba();c_7(c_8);}};switch(c_m.c_2){case'text':case'textarea':
case'password':c_bc.keyup=function(c_8){if(Uize.Node.Event.isKeyEnter(c_8)&&c_m.c_2!='textarea'){c_ba();c_4('Ok',c_8);}else if(Uize.Node.Event.isKeyEscape(c_8)){c_m.c_x();c_4('Cancel',c_8);c_y.blur();}else{c_m.set({c_U:c_m.getNodeValue(c_y),c_K:c_c});}c_9(c_8);};c_bc.click=c_7;break;case'radio':c_m.set({nodeMap:Uize.copyInto(c_m.get('nodeMap')||{},{input:Uize.Node.find({tagName:'INPUT',type:'radio',name:c_m.c_3})})});c_y=c_m.c_s();break;case'select-one':case'select-multiple':c_bc.change=c_ba;c_bc.keyup=function(c_8){c_ba();c_9(c_8);};break;}c_m.wireNode(c_y,c_bc);c_m.c_z==c_e?c_ba(c_b):c_m.c_x();}c_m.c_O();c_a.prototype.wireUi.call(c_m);}};c_l.registerProperties({c_3:'elementName',c_D:{name:'errorClassName',value:'error'},c_bd:{name:'focused',onChange:function(){var c_m=this,c_n=c_m.children.warning;c_n&&c_n.set({collapsed:!c_m.c_bd});if(c_m.isWired){var c_y=c_m.c_s();c_y&&(Uize.Node.isNode(c_y)?c_y:c_y[0])[c_m.c_bd?'focus':'blur']();}},value:c_c},c_be:{name:'isEmpty',value:c_b},c_M:{name:'isDirty',
onChange:function(){var c_m=this,c_v=c_m.c_t(),c_M=c_m.c_M=='inherit'?(c_v?c_v.get('isDirtyInherited'):c_c):c_m.c_M;c_m.set({c_J:c_M});},value:'inherit'},c_J:{name:'isDirtyInherited',onChange:c_r.c_E,value:c_c},c_K:{name:'isFinished',onChange:function(){var c_m=this;if(c_m.c_K&&c_m.c_q){c_m.c_T==c_j&&c_m.c_O();c_m.c_L||c_m.set({c_L:c_b});}c_m.c_E();},value:c_b},c_I:{name:'isValid',onChange:c_r.c_E,value:c_c},c_U:{name:'tentativeValue',onChange:function(){this.c_T==c_g&&this.c_O()},value:c_d},c_2:'type',c_T:{name:'validateWhen',value:c_g},c_P:{name:'validator',onChange:c_r.c_O,value:c_d},c_z:{name:'value',conformer:function(c_z){var c_m=this;c_z=c_m.c_2=='checkbox'?c_z==c_b:c_z;return Uize.isFunction(this.c_bf)?this.c_bf(c_z):c_z},onChange:function(){var c_m=this;if(!c_m.isWired)c_m.c_N=c_m.c_z;c_m.set({c_U:c_m.c_z,c_K:c_b,c_be:c_m.checkIsEmpty()});c_m.c_T==c_h&&c_m.c_O();c_m.c_x();},value:c_d},c_bf:'valueConformer',c_bg:{name:'warningAllowed',onChange:function(){var c_m=this,c_v=c_m.c_t(),
c_bg=c_m.c_bg=='inherit'?(c_v?c_v.get('warningAllowedInherited'):c_b):c_m.c_bg;c_m.set({c_H:c_bg});},value:'inherit'},c_H:{name:'warningAllowedInherited',onChange:c_r.c_E,value:c_c},c_C:{name:'warningMessage',onChange:[function(){var c_m=this;if(!c_m.isWired)c_m.c_0=c_m.c_C;},c_r.c_A]},c_o:{name:'warningMessageProperties',onChange:function(){this.c_n.set(this.c_o)}},c_B:{name:'warningShown',onChange:c_r.c_A,value:c_c},c_F:{name:'warningShownWhen',onChange:c_r.c_E,value:c_i},c_L:{onChange:c_r.c_E,value:c_c}});return c_l;}});